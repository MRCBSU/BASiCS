test_that("BASiCS_EffectiveSize works", {
  data(ChainSC)
  ess <- BASiCS_EffectiveSize(ChainSC, Param = "mu")
  expect_type(ess, "double")
  expect_equal(ess[[1]], 129.73861)
  expect_warning(
    BASiCS_effectiveSize(ChainSC, Param = "mu"),
    "'BASiCS_effectiveSize' is deprecated."
  )
})

test_that("utils work", {
  data(ChainSC)
  expect_equal(BASiCS:::.DistanceName("ResDisp"), "distance")
  expect_equal(BASiCS:::.DistanceName("Mean"), "fold change")
  expect_equal(BASiCS:::.LogDistanceName("ResDisp"), "distance")
  expect_equal(BASiCS:::.LogDistanceName("Mean"), "log2(fold change)")
  expect_equal(BASiCS:::.cap("test"), "Test")
  expect_equal(BASiCS:::.NSamples(ChainSC), 75)
  expect_equal(BASiCS:::.MeasureName("Mean"), "mean expression")
  expect_equal(BASiCS:::.MeasureName("Disp"), "over dispersion")
  expect_equal(BASiCS:::.MeasureName("ResDisp"), "residual over dispersion")
})

test_that("ERCC works", {
  expect_equal(
    BASiCS_CalculateERCC(Mix = 1, DilutionFactor = 1/50000, VolumePerCell = 0.009)
      c(3251.9560104, 812.9890026, 203.24725065, 101.623625325, 50.8118126625, 
      25.40590633125, 12.702953165625, 12.702953165625, 6.3514765828125, 
      3.17573829140625, 3.17573829140625, 1.58786914570313, 0.793934572851563, 
      0.793934572851563, 0.396967286967774, 0.198483643483887, 0.198483643483887, 
      0.0992418211999508, 0.0496209105999754, 0.0496209105999754, 0.0248104558419804, 
      0.0124052279209902, 0.00310130698024755, 1625.9780052, 406.4945013, 
      101.623625325, 50.8118126625, 25.40590633125, 12.702953165625, 
      6.3514765828125, 6.3514765828125, 3.17573829140625, 1.58786914570313, 
      1.58786914570313, 0.793934572851563, 0.396967286967774, 0.396967286967774, 
      0.198483643483887, 0.0992418211999508, 0.0992418211999508, 0.0496209105999754, 
      0.0248104558419804, 0.0248104558419804, 0.0124052279209902, 0.00620261396049509, 
      0.00155065403211644, 1625.9780052, 406.4945013, 101.623625325, 
      50.8118126625, 25.40590633125, 12.702953165625, 6.3514765828125, 
      6.3514765828125, 3.17573829140625, 1.58786914570313, 1.58786914570313, 
      0.793934572851563, 0.396967286967774, 0.396967286967774, 0.198483643483887, 
      0.0992418211999508, 0.0992418211999508, 0.0496209105999754, 0.0248104558419804, 
      0.0248104558419804, 0.0124052279209902, 0.00620261396049509, 
      0.00155065403211644, 1625.9780052, 406.4945013, 101.623625325, 
      50.8118126625, 25.40590633125, 12.702953165625, 6.3514765828125, 
      6.3514765828125, 3.17573829140625, 1.58786914570313, 1.58786914570313, 
      0.793934572851563, 0.396967286967774, 0.396967286967774, 0.198483643483887, 
      0.0992418211999508, 0.0992418211999508, 0.0496209105999754, 0.0248104558419804, 
      0.0248104558419804, 0.0124052279209902, 0.00620261396049509, 
      0.00155065403211644
    )
  )
})
